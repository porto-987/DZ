import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { 
  MapPin, 
  Building, 
  Scale, 
  Users, 
  Search,
  Filter,
  Calendar,
  FileText,
  Star
} from 'lucide-react';

interface AlgerianInstitution {
  id: string;
  name: string;
  nameAr: string;
  type: 'ministere' | 'tribunal' | 'administration' | 'universite';
  wilaya: string;
  address: string;
  phone?: string;
  email?: string;
  website?: string;
  services: string[];
}

interface AlgerianLegalText {
  id: string;
  title: string;
  titleAr: string;
  type: 'loi' | 'decret' | 'arrete' | 'ordonnance';
  number: string;
  date: string;
  status: 'en_vigueur' | 'abroge' | 'modifie';
  domain: string;
  authority: string;
  summary: string;
  content?: string;
}

export function EnhancedAlgerianData() {
  const [activeTab, setActiveTab] = useState<'institutions' | 'texts' | 'procedures'>('institutions');
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedWilaya, setSelectedWilaya] = useState('');

  // DonnÃ©es enrichies des institutions algÃ©riennes
  const algerianInstitutions: AlgerianInstitution[] = [
    {
      id: 'inst-1',
      name: 'MinistÃ¨re de la Justice',
      nameAr: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¹Ø¯Ù„',
      type: 'ministere',
      wilaya: 'Alger',
      address: '8, Place Bir Hakem, El Biar, Alger',
      phone: '+213 21 92 33 33',
      email: 'contact@mjustice.dz',
      website: 'www.mjustice.dz',
      services: ['Ã‰tat civil', 'Casier judiciaire', 'LÃ©galisation', 'Notariat']
    },
    {
      id: 'inst-2',
      name: 'Cour SuprÃªme',
      nameAr: 'Ø§Ù„Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø¹Ù„ÙŠØ§',
      type: 'tribunal',
      wilaya: 'Alger',
      address: '11, Chemin Ibn Badis, Kouba, Alger',
      phone: '+213 21 28 34 56',
      services: ['Pourvoi en cassation', 'Unification jurisprudence', 'Avis consultatifs']
    },
    {
      id: 'inst-3',
      name: 'Conseil d\'Ã‰tat',
      nameAr: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø¯ÙˆÙ„Ø©',
      type: 'tribunal',
      wilaya: 'Alger',
      address: '12, Rue Abderrahmane LaÃ¢la, Hydra, Alger',
      phone: '+213 21 69 12 34',
      services: ['Contentieux administratif', 'Avis juridiques', 'ContrÃ´le lÃ©galitÃ©']
    },
    {
      id: 'inst-4',
      name: 'UniversitÃ© d\'Alger 1 - FacultÃ© de Droit',
      nameAr: 'Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± 1 - ÙƒÙ„ÙŠØ© Ø§Ù„Ø­Ù‚ÙˆÙ‚',
      type: 'universite',
      wilaya: 'Alger',
      address: '2, Rue Didouche Mourad, Alger Centre',
      phone: '+213 21 63 78 90',
      email: 'droit@univ-alger.dz',
      services: ['Formation juridique', 'Recherche', 'Expertise', 'Formation continue']
    }
  ];

  // DonnÃ©es enrichies des textes juridiques algÃ©riens
  const algerianLegalTexts: AlgerianLegalText[] = [
    {
      id: 'text-1',
      title: 'Constitution de la RÃ©publique AlgÃ©rienne DÃ©mocratique et Populaire',
      titleAr: 'Ø¯Ø³ØªÙˆØ± Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©',
      type: 'loi',
      number: '2020-442',
      date: '2020-12-30',
      status: 'en_vigueur',
      domain: 'Droit constitutionnel',
      authority: 'Parlement',
      summary: 'Loi fondamentale dÃ©finissant l\'organisation de l\'Ã‰tat algÃ©rien'
    },
    {
      id: 'text-2',
      title: 'Code pÃ©nal',
      titleAr: 'Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª',
      type: 'loi',
      number: '66-156',
      date: '1966-06-08',
      status: 'en_vigueur',
      domain: 'Droit pÃ©nal',
      authority: 'Parlement',
      summary: 'DÃ©finit les infractions et les sanctions pÃ©nales en AlgÃ©rie'
    },
    {
      id: 'text-3',
      title: 'Code de procÃ©dure civile et administrative',
      titleAr: 'Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©',
      type: 'loi',
      number: '08-09',
      date: '2008-02-25',
      status: 'en_vigueur',
      domain: 'ProcÃ©dure civile',
      authority: 'Parlement',
      summary: 'RÃ¨gles de procÃ©dure devant les juridictions civiles et administratives'
    },
    {
      id: 'text-4',
      title: 'Loi sur la famille',
      titleAr: 'Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø£Ø³Ø±Ø©',
      type: 'loi',
      number: '84-11',
      date: '1984-06-09',
      status: 'modifie',
      domain: 'Droit de la famille',
      authority: 'Parlement',
      summary: 'Statut personnel et relations familiales'
    }
  ];

  const wilayas = [
    'Adrar', 'Chlef', 'Laghouat', 'Oum El Bouaghi', 'Batna', 'BÃ©jaÃ¯a', 'Biskra',
    'BÃ©char', 'Blida', 'Bouira', 'Tamanrasset', 'TÃ©bessa', 'Tlemcen', 'Tiaret',
    'Tizi Ouzou', 'Alger', 'Djelfa', 'Jijel', 'SÃ©tif', 'SaÃ¯da', 'Skikda',
    'Sidi Bel AbbÃ¨s', 'Annaba', 'Guelma', 'Constantine', 'MÃ©dÃ©a', 'Mostaganem',
    'M\'Sila', 'Mascara', 'Ouargla', 'Oran', 'El Bayadh', 'Illizi', 'Bordj Bou ArrÃ©ridj',
    'BoumerdÃ¨s', 'El Tarf', 'Tindouf', 'Tissemsilt', 'El Oued', 'Khenchela',
    'Souk Ahras', 'Tipaza', 'Mila', 'AÃ¯n Defla', 'NaÃ¢ma', 'AÃ¯n TÃ©mouchent',
    'GhardaÃ¯a', 'Relizane'
  ];

  const filteredInstitutions = algerianInstitutions.filter(inst => {
    const matchesSearch = inst.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         inst.nameAr.includes(searchQuery) ||
                         inst.services.some(service => service.toLowerCase().includes(searchQuery.toLowerCase()));
    const matchesWilaya = !selectedWilaya || inst.wilaya === selectedWilaya;
    return matchesSearch && matchesWilaya;
  });

  const filteredTexts = algerianLegalTexts.filter(text => 
    text.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
    text.titleAr.includes(searchQuery) ||
    text.domain.toLowerCase().includes(searchQuery.toLowerCase())
  );

  const renderInstitutions = () => (
    <div className="space-y-4">
      {filteredInstitutions.map(institution => (
        <Card key={institution.id} className="algerian-data hover-lift">
          <CardHeader>
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <CardTitle className="text-lg">{institution.name}</CardTitle>
                <p className="text-sm text-gray-600 font-cairo" dir="rtl">{institution.nameAr}</p>
              </div>
              <Badge variant="outline" className="ml-2">
                {institution.type}
              </Badge>
            </div>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              <div className="flex items-center gap-2 text-sm">
                <MapPin className="w-4 h-4 text-gray-500" />
                <span>{institution.address}, {institution.wilaya}</span>
              </div>
              
              {institution.phone && (
                <div className="flex items-center gap-2 text-sm">
                  <span className="w-4 h-4 text-gray-500">ðŸ“ž</span>
                  <span>{institution.phone}</span>
                </div>
              )}
              
              {institution.email && (
                <div className="flex items-center gap-2 text-sm">
                  <span className="w-4 h-4 text-gray-500">ðŸ“§</span>
                  <span>{institution.email}</span>
                </div>
              )}
              
              <div className="mt-3">
                <h4 className="text-sm font-medium mb-2">Services disponibles:</h4>
                <div className="flex flex-wrap gap-1">
                  {institution.services.map((service, index) => (
                    <Badge key={index} variant="secondary" className="text-xs">
                      {service}
                    </Badge>
                  ))}
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );

  const renderTexts = () => (
    <div className="space-y-4">
      {filteredTexts.map(text => (
        <Card key={text.id} className="algerian-data hover-lift">
          <CardHeader>
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <CardTitle className="text-lg">{text.title}</CardTitle>
                <p className="text-sm text-gray-600 font-cairo mt-1" dir="rtl">{text.titleAr}</p>
              </div>
              <div className="flex gap-2">
                <Badge variant={text.status === 'en_vigueur' ? 'default' : 'secondary'}>
                  {text.status === 'en_vigueur' ? 'En vigueur' : 
                   text.status === 'abroge' ? 'AbrogÃ©' : 'ModifiÃ©'}
                </Badge>
                <Badge variant="outline">{text.type}</Badge>
              </div>
            </div>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span className="font-medium">NumÃ©ro:</span> {text.number}
                </div>
                <div>
                  <span className="font-medium">Date:</span> {new Date(text.date).toLocaleDateString('fr-DZ')}
                </div>
                <div>
                  <span className="font-medium">Domaine:</span> {text.domain}
                </div>
                <div>
                  <span className="font-medium">AutoritÃ©:</span> {text.authority}
                </div>
              </div>
              <div>
                <p className="text-sm text-gray-600">{text.summary}</p>
              </div>
              <div className="flex gap-2">
                <Button size="sm" variant="outline">
                  <FileText className="w-3 h-3 mr-1" />
                  Consulter
                </Button>
                <Button size="sm" variant="outline">
                  <Star className="w-3 h-3 mr-1" />
                  Favoris
                </Button>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );

  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Building className="w-5 h-5 text-green-600" />
            DonnÃ©es Locales AlgÃ©riennes Enrichies
          </CardTitle>
          <p className="text-sm text-gray-600">
            AccÃ¨s aux institutions, textes juridiques et procÃ©dures officielles d'AlgÃ©rie
          </p>
        </CardHeader>
        <CardContent>
          {/* Navigation par onglets */}
          <div className="flex gap-2 mb-6">
            <Button 
              variant={activeTab === 'institutions' ? 'default' : 'outline'}
              onClick={() => setActiveTab('institutions')}
              size="sm"
            >
              <Building className="w-4 h-4 mr-2" />
              Institutions
            </Button>
            <Button 
              variant={activeTab === 'texts' ? 'default' : 'outline'}
              onClick={() => setActiveTab('texts')}
              size="sm"
            >
              <Scale className="w-4 h-4 mr-2" />
              Textes juridiques
            </Button>
            <Button 
              variant={activeTab === 'procedures' ? 'default' : 'outline'}
              onClick={() => setActiveTab('procedures')}
              size="sm"
            >
              <FileText className="w-4 h-4 mr-2" />
              ProcÃ©dures
            </Button>
          </div>

          {/* Filtres */}
          <div className="flex gap-4 mb-6">
            <div className="flex-1">
              <Input
                placeholder="Rechercher..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="max-w-md"
              />
            </div>
            
            {activeTab === 'institutions' && (
              <select
                value={selectedWilaya}
                onChange={(e) => setSelectedWilaya(e.target.value)}
                className="px-3 py-2 border border-gray-300 rounded-md"
              >
                <option value="">Toutes les wilayas</option>
                {wilayas.map(wilaya => (
                  <option key={wilaya} value={wilaya}>{wilaya}</option>
                ))}
              </select>
            )}
          </div>

          {/* Contenu basÃ© sur l'onglet actif */}
          {activeTab === 'institutions' && renderInstitutions()}
          {activeTab === 'texts' && renderTexts()}
          {activeTab === 'procedures' && (
            <div className="text-center py-8 text-gray-500">
              <FileText className="w-12 h-12 mx-auto mb-4 opacity-50" />
              <p>Section des procÃ©dures en cours de dÃ©veloppement</p>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}